let o=[],s=!1;const r=new Set;function u(){s||(chrome.webRequest.onBeforeRequest.addListener(e=>{r.has(e.requestId)||e.url.includes("mooclog.youdao.com/track/w")&&(console.log("匹配到打点请求:",e.url),r.add(e.requestId),setTimeout(()=>{r.delete(e.requestId)},5e3),o.forEach(n=>{try{n.postMessage({type:"track-request",url:e.url})}catch(t){console.error("发送消息失败:",t),o=o.filter(c=>c!==n)}}))},{urls:["*://*.youdao.com/*"]}),s=!0)}chrome.runtime.onConnect.addListener(e=>{if(e.name==="track-analyzer"){console.log("新的连接建立:",e.name),u(),o.includes(e)||o.push(e);try{e.postMessage({type:"connection-status",status:"connected"})}catch(n){console.error("发送状态消息失败:",n)}e.onDisconnect.addListener(()=>{console.log("连接断开:",e.name),o=o.filter(n=>n!==e)})}});chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e));
